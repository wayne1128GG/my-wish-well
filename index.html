<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Useless Wishing Fountain - Terminator Edition</title>
    <style>
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(to bottom, #87CEEB, #ffffff);
            font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
            overflow: hidden;
            user-select: none;
        }

        #ui-layer {
            position: absolute;
            top: 40px;
            text-align: center;
            z-index: 100;
        }

        .counter-num { font-size: 3rem; font-weight: bold; color: #2c3e50; text-shadow: 2px 2px 0 white; margin: 2px 0; }
        
        .scores-container { display: flex; gap: 15px; justify-content: center; margin-top: 5px; }

        .score-box {
            font-size: 0.9rem; color: #7f8c8d; background: rgba(255,255,255,0.6);
            padding: 8px 15px; border-radius: 15px; cursor: pointer; transition: 0.2s;
        }
        .score-box:hover { transform: scale(1.05); background: rgba(255,255,255,0.8); }

        /* å™´æ³‰ä¸»é«” */
        #fountain-world {
            position: relative;
            width: 400px;
            height: 300px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
        }
        .tier { background: #e0e0e0; border: 4px solid #bdc3c7; position: relative; display: flex; justify-content: center; }
        .top-bowl { width: 60px; height: 20px; border-radius: 50% 50% 0 0; z-index: 3; }
        .mid-bowl { width: 140px; height: 35px; border-radius: 50% 50% 10px 10px; margin-top: -5px; z-index: 2; }
        .bottom-pool { width: 300px; height: 60px; border-radius: 50% 50% 20px 20px; margin-top: -5px; z-index: 1; overflow: hidden; }
        .pillar { width: 30px; height: 40px; background: #bdc3c7; margin: -5px 0; }
        .water-blue { background: #4faef7; position: absolute; bottom: 5px; width: 90%; height: 60%; border-radius: 50%; opacity: 0.8; box-shadow: 0 0 10px #fff; }

        /* çµ‚çµè€…æ¯”è®šæ‰‹å‹¢å‹•ç•« */
        #terminator-hand {
            position: absolute;
            bottom: -80px; /* åˆå§‹éš±è—åœ¨æ°´åº• */
            font-size: 60px;
            z-index: 5;
            transition: bottom 2s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.8));
        }
        #terminator-hand.rise {
            bottom: 40px; /* å‡èµ·çš„ä½ç½® */
        }

        /* æ‰è½ç‰©å‹•ç•« */
        .item {
            position: absolute;
            width: 35px; height: 35px;
            display: flex; align-items: center; justify-content: center;
            z-index: 50; pointer-events: none;
            animation: tossItem 0.8s ease-out forwards;
        }
        .coin { background: #f1c40f; border-radius: 50%; border: 2px solid #f39c12; color: #d35400; font-weight: bold; }
        .junk { font-size: 28px; }

        @keyframes tossItem {
            0% { transform: translate(0, 0) rotate(0deg); opacity: 1; }
            40% { transform: translate(var(--x), -150px) rotate(180deg); opacity: 1; }
            100% { transform: translate(var(--x), 50px) rotate(360deg); opacity: 0; }
        }

        /* åœ–é‘‘è¦–çª— */
        #catalog-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        #catalog-box {
            background: white; padding: 30px; border-radius: 20px; text-align: center;
        }
        .junk-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 20px 0; }
        .junk-slot { width: 60px; height: 60px; background: #f0f0f0; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 30px; }
        .locked { color: #ccc; filter: brightness(0.2) grayscale(1); }
        .close-btn { background: #e74c3c; color: white; border: none; padding: 10px 25px; border-radius: 10px; cursor: pointer; }

        .tip { position: fixed; bottom: 20px; color: #7f8c8d; font-size: 0.85rem; text-align: center; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="counter-num">ğŸ’° <span id="count">0</span></div>
        <div class="scores-container">
            <div class="score-box">ğŸ† <span id="label-best">Best</span>: <span id="best-coin">0</span></div>
            <div class="score-box" onclick="toggleCatalog()">ğŸ—‘ï¸ <span id="label-junk">Junk</span>: <span id="junk-total">0</span></div>
        </div>
    </div>

    <div id="fountain-world" onclick="spawnItem(event)">
        <div id="terminator-hand">ğŸ‘</div>
        <div class="tier top-bowl"></div>
        <div class="pillar"></div>
        <div class="tier mid-bowl"><div class="water-blue"></div></div>
        <div class="pillar"></div>
        <div class="tier bottom-pool">
            <div class="water-blue" style="width: 95%; height: 70%;"></div>
        </div>
    </div>

    <div id="catalog-overlay" onclick="toggleCatalog()">
        <div id="catalog-box" onclick="event.stopPropagation()">
            <h2 id="catalog-title">Trash Gallery</h2>
            <div class="junk-grid" id="junk-grid"></div>
            <button class="close-btn" onclick="toggleCatalog()" id="btn-close">Close</button>
        </div>
    </div>

    <div class="tip" id="label-tip"></div>

    <script>
        const i18n = {
            'zh-TW': {
                best: "æœ€é«˜ç´€éŒ„", junk: "ç´¯ç©åƒåœ¾", gallery: "åƒåœ¾åœ–é‘‘", close: "é—œé–‰",
                tip: "é›†æ»¿ 8 ç¨®åƒåœ¾ï¼Œå°‡å•Ÿå‹•ã€Œå¯©åˆ¤æ—¥ã€å½©è›‹ã€‚",
                achieve: "æˆå°±é”æˆï¼šI'll be back (å¸¶è‘—åƒåœ¾)..."
            },
            'en': {
                best: "Best", junk: "Junk", gallery: "Trash Gallery", close: "Close",
                tip: "Collect 8 types of junk to trigger the Easter Egg.",
                achieve: "Achievement: I'll be back (with more trash)..."
            }
        };

        const userLang = navigator.language || navigator.userLanguage;
        const lang = userLang.includes('zh') ? 'zh-TW' : 'en';

        const JUNKS = ['ğŸŸ', 'ğŸ‘', 'ğŸ¥«', 'ğŸ¦´', 'ğŸ’©', 'ğŸšï¸', 'ğŸ€', 'ğŸ¼'];
        let unlockedJunks = JSON.parse(localStorage.getItem('unlockedJunks')) || [];
        let isAchieved = false;

        document.getElementById('label-best').innerText = i18n[lang].best;
        document.getElementById('label-junk').innerText = i18n[lang].junk;
        document.getElementById('catalog-title').innerText = i18n[lang].gallery;
        document.getElementById('btn-close').innerText = i18n[lang].close;
        document.getElementById('label-tip').innerText = i18n[lang].tip;

        let coinCount = 0;
        let junkTotal = parseInt(localStorage.getItem('fountainJunkCount')) || 0;
        let bestCoin = parseInt(localStorage.getItem('fountainBestCoin')) || 0;
        
        document.getElementById('best-coin').innerText = bestCoin;
        document.getElementById('junk-total').innerText = junkTotal;

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(freq, type, duration, volume) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(volume, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function checkAchievement() {
            if (unlockedJunks.length === JUNKS.length && !isAchieved) {
                isAchieved = true;
                const hand = document.getElementById('terminator-hand');
                hand.classList.add('rise');
                document.getElementById('label-tip').innerText = i18n[lang].achieve;
                
                // æ’­æ”¾ä¸€å€‹è‹±é›„å¼çš„è€é›»å½±éŸ³æ•ˆ
                setTimeout(() => {
                    playSound(200, 'square', 1.5, 0.1);
                    setTimeout(() => playSound(150, 'square', 1.0, 0.1), 300);
                }, 500);
            }
        }

        function toggleCatalog() {
            const overlay = document.getElementById('catalog-overlay');
            if (overlay.style.display === 'flex') {
                overlay.style.display =
